<app-cabecera></app-cabecera>
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Gestión de Productos</h1>
    <button class="btn btn-primary" (click)="showCreateForm()">
      <i class="fas fa-plus me-2"></i>Nuevo Producto
    </button>
  </div>

  @if (showForm) {
  <div class="mb-4">
    <app-producto-form
      [producto]="editingProducto"
      [isEditing]="isEditing"
      (productoGuardado)="onProductoGuardado($event)"
      (cancelar)="hideForm()"
    ></app-producto-form>
  </div>
  } @if (loading) {
  <div class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2">Cargando productos...</p>
  </div>
  } @if (error) {
  <div class="alert alert-danger" role="alert">
    <h4 class="alert-heading">Error</h4>
    <p>{{ error }}</p>
    <hr />
    <button class="btn btn-outline-danger" (click)="retry()">Reintentar</button>
  </div>
  } @if (!loading && !error && productos.length === 0) {
  <div class="alert alert-info" role="alert">
    <h4 class="alert-heading">Sin productos</h4>
    <p>No hay productos disponibles en este momento.</p>
    <button class="btn btn-primary" (click)="showCreateForm()">Crear Primer Producto</button>
  </div>
  } @if (!loading && !error && productos.length > 0) {
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Descripción</th>
          <th>Categoría</th>
          <th>Stock</th>
          <th>Precio</th>
          <th>Peso</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (producto of productos; track producto.id) {
        <tr>
          <td>{{ producto.id }}</td>
          <td>
            <strong>{{ producto.nombre }}</strong>
          </td>
          <td>
            <span
              class="text-truncate d-inline-block"
              style="max-width: 200px"
              [title]="producto.descripcion"
            >
              {{ producto.descripcion }}
            </span>
          </td>
          <td>
            @if (producto.categoria) {
            <span class="badge bg-info">{{ producto.categoria.nombre || producto.categoria }}</span>
            } @else {
            <span class="text-muted">Sin categoría</span>
            }
          </td>
          <td>
            <span
              class="badge"
              [class.bg-warning]="producto.stock < 10"
              [class.bg-success]="producto.stock >= 10"
            >
              {{ producto.stock }}
            </span>
          </td>
          <td>
            <strong class="text-success">${{ producto.precio | number : '1.2-2' }}</strong>
          </td>
          <td>{{ producto.peso }} kg</td>
          <td>
            <span [class]="getDisponibleClass(producto.disponible)">
              {{ getDisponibleText(producto.disponible) }}
            </span>
          </td>
          <td>
            <div class="btn-group" role="group">
              <button
                class="btn btn-sm btn-outline-primary"
                (click)="showEditForm(producto)"
                title="Editar producto"
              >
                <i class="fas fa-edit"></i>
              </button>
              <button
                class="btn btn-sm btn-outline-danger"
                (click)="confirmDelete(producto)"
                [disabled]="deletingId === producto.id"
                title="Eliminar producto"
              >
                @if (deletingId === producto.id) {
                <span
                  class="spinner-border spinner-border-sm"
                  role="status"
                  aria-hidden="true"
                ></span>
                } @else {
                <i class="fas fa-trash"></i>
                }
              </button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  }
</div>
<app-pie></app-pie>
